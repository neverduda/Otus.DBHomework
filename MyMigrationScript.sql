CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE "Products" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Price" integer NOT NULL,
    "Desription" text NULL,
    CONSTRAINT "PK_Products" PRIMARY KEY ("Id")
);

CREATE TABLE "Users" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "FirstName" text NOT NULL,
    "LastName" text NULL,
    "PhoneNumber" text NOT NULL,
    CONSTRAINT "PK_Users" PRIMARY KEY ("Id")
);

CREATE TABLE "Advertisements" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "SellerId" integer NOT NULL,
    "BuyerId" integer NULL,
    "ProductId" integer NOT NULL,
    "PublicationDate" timestamp with time zone NULL,
    "Status" integer NOT NULL,
    CONSTRAINT "PK_Advertisements" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Advertisements_Products_ProductId" FOREIGN KEY ("ProductId") REFERENCES "Products" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_Advertisements_Users_BuyerId" FOREIGN KEY ("BuyerId") REFERENCES "Users" ("Id"),
    CONSTRAINT "FK_Advertisements_Users_SellerId" FOREIGN KEY ("SellerId") REFERENCES "Users" ("Id") ON DELETE CASCADE
);

INSERT INTO "Products" ("Id", "Desription", "Name", "Price")
VALUES (1, NULL, 'Phone', 12000);
INSERT INTO "Products" ("Id", "Desription", "Name", "Price")
VALUES (2, NULL, 'Basketball ball Wilson', 7000);
INSERT INTO "Products" ("Id", "Desription", "Name", "Price")
VALUES (3, NULL, 'Nike sport shoes', 15000);
INSERT INTO "Products" ("Id", "Desription", "Name", "Price")
VALUES (4, NULL, 'SUP Serf', 50000);
INSERT INTO "Products" ("Id", "Desription", "Name", "Price")
VALUES (5, NULL, 'Backpack', 5000);

INSERT INTO "Users" ("Id", "FirstName", "LastName", "PhoneNumber")
VALUES (1, 'Sergey', 'Dudkin', '77777');
INSERT INTO "Users" ("Id", "FirstName", "LastName", "PhoneNumber")
VALUES (2, 'Mary', 'Mary', '888888888');
INSERT INTO "Users" ("Id", "FirstName", "LastName", "PhoneNumber")
VALUES (3, 'Serg', NULL, '888888888');
INSERT INTO "Users" ("Id", "FirstName", "LastName", "PhoneNumber")
VALUES (4, 'Alex', NULL, '111');
INSERT INTO "Users" ("Id", "FirstName", "LastName", "PhoneNumber")
VALUES (5, 'Ivan', 'Vasilev', '222');

INSERT INTO "Advertisements" ("Id", "BuyerId", "ProductId", "PublicationDate", "SellerId", "Status")
VALUES (1, 2, 1, NULL, 1, 1);
INSERT INTO "Advertisements" ("Id", "BuyerId", "ProductId", "PublicationDate", "SellerId", "Status")
VALUES (2, 3, 2, NULL, 2, 2);
INSERT INTO "Advertisements" ("Id", "BuyerId", "ProductId", "PublicationDate", "SellerId", "Status")
VALUES (3, NULL, 3, NULL, 3, 3);
INSERT INTO "Advertisements" ("Id", "BuyerId", "ProductId", "PublicationDate", "SellerId", "Status")
VALUES (4, NULL, 4, NULL, 4, 4);
INSERT INTO "Advertisements" ("Id", "BuyerId", "ProductId", "PublicationDate", "SellerId", "Status")
VALUES (5, NULL, 5, NULL, 5, 5);

CREATE INDEX "IX_Advertisements_BuyerId" ON "Advertisements" ("BuyerId");

CREATE INDEX "IX_Advertisements_ProductId" ON "Advertisements" ("ProductId");

CREATE INDEX "IX_Advertisements_SellerId" ON "Advertisements" ("SellerId");

SELECT setval(
    pg_get_serial_sequence('"Products"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Products") + 1,
        nextval(pg_get_serial_sequence('"Products"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"Users"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Users") + 1,
        nextval(pg_get_serial_sequence('"Users"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"Advertisements"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Advertisements") + 1,
        nextval(pg_get_serial_sequence('"Advertisements"', 'Id'))),
    false);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20230822211731_Initial', '7.0.10');

COMMIT;

